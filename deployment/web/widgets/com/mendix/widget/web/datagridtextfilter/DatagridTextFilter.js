define(["react","mendix/filters/builders"],(function(e,t){"use strict";var n,l={exports:{}};
/*!
  	Copyright (c) 2018 Jed Watson.
  	Licensed under the MIT License (MIT), see
  	http://jedwatson.github.io/classnames
  */n=l,function(){var e={}.hasOwnProperty;function t(){for(var n=[],l=0;l<arguments.length;l++){var a=arguments[l];if(a){var r=typeof a;if("string"===r||"number"===r)n.push(a);else if(Array.isArray(a)){if(a.length){var i=t.apply(null,a);i&&n.push(i)}}else if("object"===r){if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]")){n.push(a.toString());continue}for(var u in a)e.call(a,u)&&a[u]&&n.push(u)}}}return n.join(" ")}n.exports?(t.default=t,n.exports=t):window.classNames=t}();var a=l.exports;function r(t,n){const[l,a]=e.useState(),r=e.useCallback((()=>{a((e=>{const n=null==t?void 0:t.getBoundingClientRect();return a=n,(l=e)&&a&&l.height===a.height&&l.width===a.width&&l.bottom===a.bottom&&l.top===a.top&&l.left===a.left&&l.right===a.right?e:n;var l,a}))}),[t]);var i;return i=n?r:void 0,e.useEffect((()=>i?function(e){let t;const n=()=>{t=window.requestAnimationFrame((()=>{e(),n()}))},l=()=>window.cancelAnimationFrame(t);return n(),l}(i):void 0),[i]),l}function i(t){const n=t.defaultFilter,l=t.onChange,[i,u]=e.useState(n),[o,s]=e.useState(!1),c=e.useRef(null),d=e.useRef(null);var p,f;p=[c,d],f=()=>s(!1),e.useEffect((()=>{const e=e=>{if(Array.isArray(p)){if(p.some((t=>!t.current||t.current.contains(e.target))))return}else if(!p.current||p.current.contains(e.target))return;f()};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[p,f]);const v=r(c.current,o),m=e.useCallback((e=>{u(e),l(e),s(!1)}),[l]);e.useEffect((()=>{u(n),l(n)}),[n,l]);const b=e.createElement("ul",{ref:d,id:"".concat(t.id,"-filter-selectors"),className:"filter-selectors",role:"menu","data-focusindex":0,style:{position:"fixed",top:null==v?void 0:v.bottom,left:null==v?void 0:v.left}},t.options.map(((n,l)=>e.createElement("li",{className:a({"filter-selected":i===n.value}),key:l,onClick:e=>{e.preventDefault(),e.stopPropagation(),m(n.value)},onKeyDown:e=>{if("Enter"===e.key||" "===e.key)e.preventDefault(),e.stopPropagation(),m(n.value);else if("Tab"===e.key&&l+1===t.options.length)e.preventDefault(),m(i);else if("Tab"===e.key&&e.shiftKey&&0===l||"Escape"===e.key){var a;e.preventDefault(),null===(a=c.current)||void 0===a||null===(a=a.querySelector("button"))||void 0===a||a.focus(),s(!1)}},role:"menuitem",tabIndex:0},e.createElement("div",{className:a("filter-icon",n.value),"aria-hidden":!0}),e.createElement("div",{className:"filter-label"},n.label))))),h=e.useCallback((()=>{s((e=>!e)),setTimeout((()=>{var e;null===(e=d.current)||void 0===e||null===(e=e.querySelector("li.filter-selected"))||void 0===e||e.focus()}),10)}),[]);return e.createElement("div",{className:"filter-selector"},e.createElement("div",{className:"filter-selector-content",ref:c},e.createElement("button",{"aria-controls":"".concat(t.id,"-filter-selectors"),"aria-expanded":o,"aria-haspopup":!0,"aria-label":t.ariaLabel,className:a("btn btn-default filter-selector-button button-icon",i),onClick:h,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),h())}},"Â "),o&&b))}const u=(e,t)=>{let n=null;const l=()=>{null!==n&&(clearTimeout(n),n=null)};return[function(){for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];l(),n=setTimeout((()=>e(...r)),t)},l]};function o(e,t){return n=>n[e]!==t?{...n,[e]:t}:n}function s(t,n,l){const a=function(t){const n=e.useRef(t);return e.useEffect((()=>{n.current=t})),e.useCallback((function(){for(var e=arguments.length,t=new Array(e),l=0;l<e;l++)t[l]=arguments[l];return n.current&&n.current.apply(void 0,t)}),[])}(n),[r]=e.useState((()=>u(a,l)[0])),i=e.useRef(null),o=e.useRef(t);return e.useEffect((()=>{var e;const{current:n}=o;t.type!==n.type?(a(t.inputValue,t.type),null===(e=i.current)||void 0===e||e.focus()):t.inputValue!==n.inputValue&&r(t.inputValue,t.type),o.current=t}),[t]),[i]}const c=e.memo((function(t){var n;const{current:l}=e.useRef(t.initialFilterType);return e.createElement("div",{className:a("filter-container",t.className),"data-focusindex":null!==(n=t.tabIndex)&&void 0!==n?n:0,style:t.styles},t.adjustable&&e.createElement(i,{ariaLabel:t.screenReaderButtonCaption,id:t.id,defaultFilter:l,onChange:t.onFilterTypeClick,options:[{value:"contains",label:"Contains"},{value:"startsWith",label:"Starts with"},{value:"endsWith",label:"Ends with"},{value:"greater",label:"Greater than"},{value:"greaterEqual",label:"Greater than or equal"},{value:"equal",label:"Equal"},{value:"notEqual",label:"Not equal"},{value:"smaller",label:"Smaller than"},{value:"smallerEqual",label:"Smaller than or equal"},{value:"empty",label:"Empty"},{value:"notEmpty",label:"Not empty"}]}),e.createElement("input",{"aria-label":t.screenReaderInputCaption,className:a("form-control",{"filter-input":t.adjustable}),disabled:t.inputDisabled,onChange:t.onInputChange,placeholder:t.placeholder,ref:t.inputRef,type:"text",value:t.inputValue}))}));function d(t){const[n,l,a]=function(t){const[n,l]=e.useState(t),[a,r]=e.useMemo((()=>[e=>l(o("inputValue",e.target.value)),e=>l(o("type",e))]),[]);return[n,a,r]}((()=>{var e;return{inputValue:null!==(e=t.initialFilterValue)&&void 0!==e?e:"",type:t.initialFilterType}})),[r]=s(n,((e,n)=>{var l;return null===(l=t.updateFilters)||void 0===l?void 0:l.call(t,e,n)}),t.inputChangeDelay);return function(t){e.useEffect((()=>{var e;void 0!==t.initialFilterValue&&(null===(e=t.updateFilters)||void 0===e||e.call(t,t.initialFilterValue,t.initialFilterType))}),[])}(t),e.createElement(c,{initialFilterType:t.initialFilterType,onFilterTypeClick:a,onInputChange:l,inputRef:r,inputValue:n.inputValue,inputDisabled:"empty"===n.type||"notEmpty"===n.type,adjustable:t.adjustable,className:t.className,id:t.id,placeholder:t.placeholder,screenReaderButtonCaption:t.screenReaderButtonCaption,screenReaderInputCaption:t.screenReaderInputCaption,styles:t.styles,tabIndex:t.tabIndex})}const p=t=>{let{className:n,bootstrapStyle:l,children:r,role:i}=t;return e.Children.count(r)>0?e.createElement("div",{className:a("alert alert-".concat(l),n),role:i},r):null};var f;p.displayName="Alert",function(e){e.STRING="string",e.NUMBER="number",e.ENUMERATION="enum",e.DATE="date",e.ASSOCIATION="association"}(f||(f={}));const v="com.mendix.widgets.web.filterable.filterContext";function m(e){if(e&&1===e.length){const[t]=e;let n="equal";switch(t.type){case"contains":n="contains";break;case"starts-with":n="startsWith";break;case"ends-with":n="endsWith";break;case">":n="greater";break;case">=":n="greaterEqual";break;case"=":n="equal";break;case"!=":n="notEqual";break;case"<":n="smaller";break;case"<=":n="smallerEqual"}return{type:n,value:String(t.value)}}}function b(e){if(e)return Object.keys(e).map((t=>e[t])).filter((e=>e.type.match(/HashString|String/)))}return function(n){const l=e.useRef("TextFilter".concat(function(){const e="com.mendix.widgets.web.UUID";return window[e]||(window[e]=1),window[e]++}())),a=window[v],r=e.createElement(p,{bootstrapStyle:"danger"},"The Text filter widget must be placed inside the header of the Data grid 2.0 or Gallery widget."),i=e.createElement(p,{bootstrapStyle:"danger"},'The Text filter widget can\'t be used with the filters options you have selected. It requires a "Hashed string or String" attribute to be selected.');return(null==a?void 0:a.Consumer)?e.createElement(a.Consumer,null,(a=>{var u,o,s,c,v,h,y,g;if(!a||!a.filterDispatcher||!a.singleAttribute&&!a.multipleAttributes)return r;const{filterDispatcher:E,singleAttribute:w,multipleAttributes:C,singleInitialFilter:S,multipleInitialFilters:T}=a,q=[...w?[w]:[],...C&&null!==(u=b(C))&&void 0!==u?u:[]];if(0===q.length)return C?i:r;const k=m(S||(null==T?void 0:T[q[0].id])),N=(x=q[0].type)&&!x.match(/HashString|String/)?"The attribute type being used for Text filter is not 'Hashed string or String'":null;var x;return N?e.createElement(p,{bootstrapStyle:"danger"},N):"loading"===(null===(o=n.defaultValue)||void 0===o?void 0:o.status)?null:e.createElement(d,{adjustable:n.adjustable,className:n.class,initialFilterType:null!==(s=null==k?void 0:k.type)&&void 0!==s?s:n.defaultFilter,initialFilterValue:null!==(c=null==k?void 0:k.value)&&void 0!==c?c:null===(v=n.defaultValue)||void 0===v?void 0:v.value,inputChangeDelay:n.delay,id:l.current,placeholder:null===(h=n.placeholder)||void 0===h?void 0:h.value,screenReaderButtonCaption:null===(y=n.screenReaderButtonCaption)||void 0===y?void 0:y.value,screenReaderInputCaption:null===(g=n.screenReaderInputCaption)||void 0===g?void 0:g.value,styles:n.style,tabIndex:n.tabIndex,updateFilters:(e,l)=>{var a,r;null===(a=n.valueAttribute)||void 0===a||a.setValue(e),null===(r=n.onChange)||void 0===r||r.execute();const i=null==q?void 0:q.map((n=>function(e,n,l){if(!e||!e.filterable||"empty"!==l&&"notEmpty"!==l&&!n)return;return{contains:t.contains,startsWith:t.startsWith,endsWith:t.endsWith,greater:t.greaterThan,greaterEqual:t.greaterThanOrEqual,equal:t.equals,notEqual:t.notEqual,smaller:t.lessThan,smallerEqual:t.lessThanOrEqual,empty:t.equals,notEmpty:t.notEqual}[l](t.attribute(e.id),t.literal("empty"===l||"notEmpty"===l?void 0:n))}(n,e,l))).filter((e=>void 0!==e));E({getFilterCondition:()=>i&&i.length>1?t.or(...i):null==i?void 0:i[0],filterType:f.STRING})}})})):r}}));
